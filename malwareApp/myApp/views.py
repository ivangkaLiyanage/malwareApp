from django.shortcuts import render, redirect
from django.core.files.storage import FileSystemStorage
from django.http import HttpResponse
from django.urls import reverse
#import uplod file database
from .models import UploadedMalwareFile
#pdf
import pdfkit
from django.template.loader import get_template

#pdf download
config = pdfkit.configuration(wkhtmltopdf='/usr/local/bin/wkhtmltopdf')

def home(request):
    # Add any logic for the home page here
    return render(request, 'home.html')


def analyze(request):
    # Add any logic for the home page here
    return render(request, 'analyze.html')


#downloading result pdf
def generate_pdf(request):


    return "Hello World"


#for upload file
def upload_file(request):
    if request.method == 'POST':
        #takes the data of the input field with the name=malware
        malware_file = request.FILES.get('malware')
        if malware_file:
            file_name = malware_file.name
            file_size = malware_file.size
            new_file = UploadedMalwareFile(file=malware_file, file_name=file_name, file_size=file_size)
            new_file.save()
            return redirect('results', id=new_file.id)
    return render(request, 'analyze.html')

def results(request, id):
    malware = UploadedMalwareFile.objects.filter(id=id)
    
    return render(request, 'result.html', {'data': malware})






